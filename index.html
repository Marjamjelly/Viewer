<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Reddit NSFW Image Viewer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { background:#181818; color:#f0f0f0; font-family:sans-serif; margin:0;}
    h1 { text-align:center; margin-top:1em;}
    #searchForm {display:flex; justify-content:center; margin-bottom:1em;}
    #searchInput {width:300px; padding:0.5em; font-size:1em;}
    #searchForm button { padding:0.5em 1.2em; font-size:1em;}
    #gallery { display:grid; grid-template-columns:repeat(auto-fit,minmax(180px,1fr)); gap:1em; padding:1em; max-width:1200px; margin:0 auto;}
    .thumbnail { width:100%; cursor:pointer; border-radius:5px; transition:transform 0.15s; box-shadow:0 2px 10px rgba(0,0,0,0.2); object-fit:cover; background:#222;}
    .thumbnail:hover { transform:scale(1.05);}
    .modal { display:none; position:fixed; z-index:100; padding-top:60px; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.92);}
    .modal-content { margin:auto; display:block; max-width:90vw; max-height:80vh; border-radius:6px; box-shadow:0 4px 32px rgba(0,0,0,0.5);}
    #caption {margin:1em auto; text-align:center; color:#ccc; max-width:900px; font-size:1.1em;}
    .close {position:absolute; top:30px; right:45px; color:#fff; font-size:2.5em; font-weight:bold; cursor:pointer; user-select:none; transition:color 0.2s;}
    .close:hover, .close:focus {color:#e74c3c;}
  </style>
</head>
<body>
  <h1>Reddit NSFW Image Viewer</h1>
  <form id="searchForm">
    <input type="text" id="searchInput" placeholder="Subreddit (e.g. nsfw, gonewild)" required>
    <button type="submit">Search</button>
  </form>
  <div id="gallery"></div>
  <div id="modal" class="modal">
    <span class="close" id="closeModal">&times;</span>
    <img class="modal-content" id="modalImg">
    <div id="caption"></div>
  </div>
  <script>
    const form = document.getElementById('searchForm');
    const input = document.getElementById('searchInput');
    const gallery = document.getElementById('gallery');
    const modal = document.getElementById('modal');
    const modalImg = document.getElementById('modalImg');
    const caption = document.getElementById('caption');
    const closeModal = document.getElementById('closeModal');
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const subreddit = input.value.trim();
      if (!subreddit) return;
      gallery.innerHTML = '<p>Loading...</p>';
      try {
        const resp = await fetch(`https://www.reddit.com/r/${encodeURIComponent(subreddit)}/.json?limit=60`);
        if (!resp.ok) throw new Error('API error');
        const data = await resp.json();
        if (!Array.isArray(data.data.children) || data.data.children.length === 0) {
          gallery.innerHTML = '<p>No results found.</p>';
          return;
        }
        gallery.innerHTML = '';
        data.data.children.forEach(item => {
          const post = item.data;
          if (
            post.post_hint === "image" &&
            post.preview &&
            post.preview.images &&
            post.preview.images[0] &&
            post.preview.images[0].source &&
            post.preview.images[0].source.url
          ) {
            const img = document.createElement('img');
            img.src = post.preview.images[0].source.url.replace(/&amp;/g,"&");
            img.alt = post.title;
            img.className = 'thumbnail';
            img.loading = 'lazy';
            img.addEventListener('click', () => {
              modal.style.display = 'block';
              modalImg.src = post.url_overridden_by_dest || img.src;
              caption.textContent = post.title;
            });
            gallery.appendChild(img);
          }
        });
      } catch (err) {
        gallery.innerHTML = `<p>Error fetching images: ${err.message}</p>`;
      }
    });
    closeModal.onclick = function() {
      modal.style.display = 'none';
      modalImg.src = '';
      caption.textContent = '';
    };
    window.onclick = function(event) {
      if (event.target == modal) {
        modal.style.display = 'none';
        modalImg.src = '';
        caption.textContent = '';
      }
    };
  </script>
</body>
</html>
